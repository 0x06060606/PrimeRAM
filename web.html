<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Android RAM Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-3">
        <h1>Android RAM Analyzer</h1>
        <p class="lead" id="status">Select a file to analyze</p>
        <input type="file" id="file-input" class="form-control">
        <div class="progress my-3" style="display: none;">
            <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script>
        window.blobParts = [];
        window.fullBlob = null;
        document.getElementById('file-input').addEventListener('change', function(event) {
            $('#file-input').prop('disabled', true);
            $('#status').text('Reading RAM dump...');
            $('#file-input').hide();
            $('#progress-bar').parent().show();
            const file = event.target.files[0];
            if (!file) {
                return;
            } else if (file.size < 30 * 1024 * 1024) {
                window.fullBlob = file;
                return;
            }
            window.offset = 0;
            const chunkSize = 30 * 1024 * 1024;
            const reader = new FileReader();
            function updateProgress(percent) {
                const progressBar = document.getElementById('progress-bar');
                progressBar.style.width = percent + '%';
                progressBar.setAttribute('aria-valuenow', percent);
            }
            reader.onload = function(event) {
                const arrayBuffer = event.target.result;
                window.blobParts.push(new Blob([arrayBuffer]));
                window.offset += arrayBuffer.byteLength;
                readNextChunk();
            };
            reader.onerror = function(event) {
                console.error('Error reading file:', event.target.error);
            };
            function readNextChunk() {
                if (window.offset >= file.size) {
                    console.log('Read complete');
                    updateProgress(100);
                    window.fullBlob = new Blob(window.blobParts, { type: file.type });
                    $('#progress-bar').parent().hide();
                    let GB = window.fullBlob.size / 1024 / 1024 / 1024;
                    $('#status').text('RAM dump loaded (' + GB.toFixed(2) + ' GB)');
                    const progressBar = document.getElementById('progress-bar');
                    progressBar.style.width = '0%';
                    progressBar.setAttribute('aria-valuenow', 0);
                    analyze(window.fullBlob);
                    return;
                }
                const slice = file.slice(window.offset, window.offset + chunkSize);
                reader.readAsArrayBuffer(slice);
                updateProgress((window.offset / file.size) * 100);
            }
            readNextChunk();
        });
        function analyze(blob) {
            $('#status').text('RAM dump loaded (' + (blob.size / 1024 / 1024 / 1024).toFixed(2) + ' GB) - Carving...');
            const pngs = [];
            const pngHeader = new Uint8Array([137, 80, 78, 71, 13, 10, 26, 10]);
            const reader = new FileReader();
            reader.onload = function(event) {
                $('#status').text('RAM dump loaded (' + (blob.size / 1024 / 1024 / 1024).toFixed(2) + ' GB) - Carving (' + pngs.length + ' PNGs found)');
                const arrayBuffer = event.target.result;
                const data = new Uint8Array(arrayBuffer);
                for (let i = 0; i < data.length - 8; i++) {
                    if (data[i] === pngHeader[0] && data[i + 1] === pngHeader[1] && data[i + 2] === pngHeader[2] && data[i + 3] === pngHeader[3] && data[i + 4] === pngHeader[4] && data[i + 5] === pngHeader[5] && data[i + 6] === pngHeader[6] && data[i + 7] === pngHeader[7]) {
                        const png = data.slice(i);
                        pngs.push(png);
                        i += 8;
                        $('#status').text('RAM dump loaded (' + (blob.size / 1024 / 1024 / 1024).toFixed(2) + ' GB) - Carving (' + pngs.length + ' PNGs found)');
                    }
                }
            };
            reader.onerror = function(event) {
                console.error('Error reading file:', event.target.error);
            };
            reader.readAsArrayBuffer(blob);
        }
    </script>
</body>
</html>
